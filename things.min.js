/*!
* things. it's so thingy.
* v0.0.1 @stephenplusplus 3/18/13
* github.com/stephenplusplus/things
*/
(function(e){"use strict";var n={}.toString,t=function(e,n){return typeof e===n},r=function(e){return!o(e)},o=function(e){return t(e,"undefined")},i=function(e){return"[object Function]"===n.call(e)},c=function(e){return"[object Array]"===n.call(e)},u=function(n){var t=i(n),u=Array.prototype.forEach,d=function(e){return r(e)?e.querySelectorAll.bind(e):void 0};return function(){var a={matches:null,find:function(e){var n,t=d(a.matches[0]);return i(t)&&(n=t(e)),r(n)&&r(n[0])&&(a.matches=n),a},html:function(e){return o(e)?a.matches[0].innerHTML:(i(e)||c(e)||u.call(a.matches,function(n){return n.innerHTML=e}),void 0)}};return t?n(arguments[0]):(a.matches=d(e.document)(arguments[0]),a)}}(e.jQuery),d=["route","service","thing"],a={},f={},p=function(e,n){if(!r(e.route[n].__datael)){var t=u('[data-route="'+n+'"]'),o=t.find("[data-el]");e.route[n].__dataroute=t,e.route[n].__datael=r(o[0])?o:t}},s=function(e,n){return e.route[n].__datael},y=function(e,n,t,r){if("service"===n&&!i(r)&&o(e.service[t].__invoked))throw Error("Services must be functions!");if(e[n][t]=r,i(r)){var c=(""+r).match(/^\s*function\s*\((.*?)\)/);e[n][t].__dependencies=c&&""!==c[1]?c[1].replace(/\s/g,"").split(","):[]}"service"===n&&o(e.service[t].__invoked)&&(e.service[t].__invoked=!1)},v=function(e,n,t){var i={dependencyType:void 0,dependency:void 0};if(o(n)&&o(t))return i;if(r(n)&&r(t)?(i.dependencyType=t,i.dependency=e[t][n]):i.dependency=d.filter(function(t){return r(e[t][n])?(i.dependencyType=t,e[t][n]):void 0})[0],!i.dependency||!i.dependencyType)throw Error(n+" doesn't appear to be a thing.");return i},_=function(e,n,t){var r=v(e,n,t).dependency,o=r?e[t][n].__dependencies:[],c="route"===t,u=e.__incomingRoute!==e.__activeRoute,d="service"===t,a=d&&e.service[n].__invoked;if(c){if(u)return"Routes cannot be dependencies, sorry!";e.__incomingRoute=n}c&&"$el"===n&&(r=s(e,e.__incomingRoute));e:if(i(r)){if(a)break e;r=new r(_(e,o[0],v(e,o[0]).dependencyType),_(e,o[1],v(e,o[1]).dependencyType),_(e,o[2],v(e,o[2]).dependencyType),_(e,o[3],v(e,o[3]).dependencyType),_(e,o[4],v(e,o[4]).dependencyType),_(e,o[5],v(e,o[5]).dependencyType),_(e,o[6],v(e,o[6]).dependencyType),_(e,o[7],v(e,o[7]).dependencyType),_(e,o[8],v(e,o[8]).dependencyType),_(e,o[9],v(e,o[9]).dependencyType)),d&&(y(e,"service",n,r),e.service[n].__invoked=!0)}return c&&(e.__activeRoute=n),r};e.things=function(){var n=function(n){if(o(n))throw Error("Hey! Name your things!");var t=f[n];if(r(t))return t;var c=a[n]={__incomingRoute:null,__activeRoute:null,route:{},service:{},thing:{},boot:{}},d=function(e){return function(t,r){return y(c,e,t,r),f[n]}},s=function(e){return p(c,e),_(c,e,"route"),f[n]},v=function(e){if(i(e)){var t=(""+e).substr(10,30).replace(/[^\w]|\s/g,"");return y(c,"boot",t,e),l&&_(c,t,"boot"),f[n]}};y(c,"thing","root",window),y(c,"service","goTo",function(){return s}),y(c,"service","$",function(){return u}),y(c,"thing","$el",u);var l="complete"===document.readyState;return e.onload=function(){l=!0;for(var e in c.boot)c.boot.hasOwnProperty(e)&&_(c,e,"boot")},f[n]={route:d("route"),service:d("service"),thing:d("thing"),goTo:s,boots:v}};return n}()})(window);