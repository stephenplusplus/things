/*!
* things. it's so thingy.
* v0.0.1 @stephenplusplus 3/16/13
* github.com/stephenplusplus/things
*/
(function(e){"use strict";var n={}.toString,t=function(e,n){return typeof e===n},r=function(e){return!o(e)},o=function(e){return t(e,"undefined")},i=function(e){return"[object Function]"===n.call(e)},c=function(e){return"[object Array]"===n.call(e)},u=function(n){var t=i(n),u=Array.prototype.forEach,d=function(e){return r(e)?e.querySelectorAll.bind(e):void 0};return function(){var a={matches:null,find:function(e){var n,t=d(a.matches[0]);return i(t)&&(n=t(e)),r(n)&&r(n[0])&&(a.matches=n),a},html:function(e){return o(e)?a.matches[0].innerHTML:(i(e)||c(e)||u.call(a.matches,function(n){return n.innerHTML=e}),void 0)}};return t?n(arguments[0]):(a.matches=d(e.document)(arguments[0]),a)}}(e.jQuery),d=["route","service","thing"],a={},f={},p=function(e,n){if(!r(e.route[n].__datael)){var t=u('[data-route="'+n+'"]'),o=t.find("[data-el]");e.route[n].__dataroute=t,e.route[n].__datael=r(o[0])?o:t}},v=function(e,n){return e.route[n].__datael},s=function(e,n,t,r){if("service"===n&&!i(r)&&o(e.service[t].__invoked))throw Error("Services must be functions!");if(e[n][t]=r,i(r)){var c=(""+r).match(/^\s*function\s*\((.*?)\)/);e[n][t].__dependencies=c&&""!==c[1]?c[1].replace(/\s/g,"").split(","):[]}"service"===n&&o(e.service[t].__invoked)&&(e.service[t].__invoked=!1)},y=function(e,n,t){var o={dependencyType:void 0,dependency:void 0};if(!r(n)&&!r(t))return o;if(r(n)&&r(t)?(o.dependencyType=t,o.dependency=e[t][n]):o.dependency=d.filter(function(t){return r(e[t][n])?(o.dependencyType=t,e[t][n]):void 0})[0],!o.dependency||!o.dependencyType)throw Error(n+" doesn't appear to be a thing.");return o},_=function(e,n,t){var r=y(e,n,t).dependency,o=r?e[t][n].__dependencies:[],c="route"===t,u="service"===t,d=u&&e.service[n].__invoked;c&&(e.__incomingRoute=n),"$el"===n&&e.__incomingRoute!==e.__activeRoute&&(r=v(e,e.__incomingRoute));e:if(i(r)){if(d)break e;r=new r(_(e,o[0],y(e,o[0]).dependencyType),_(e,o[1],y(e,o[1]).dependencyType),_(e,o[2],y(e,o[2]).dependencyType),_(e,o[3],y(e,o[3]).dependencyType),_(e,o[4],y(e,o[4]).dependencyType),_(e,o[5],y(e,o[5]).dependencyType),_(e,o[6],y(e,o[6]).dependencyType),_(e,o[7],y(e,o[7]).dependencyType),_(e,o[8],y(e,o[8]).dependencyType),_(e,o[9],y(e,o[9]).dependencyType)),u&&(s(e,"service",n,r),e.service[n].__invoked=!0)}return c&&(e.__activeRoute=n),r};e.things=function(){var n=function(n){var t=f[n];if(r(t))return t;var o=a[n]={__incomingRoute:null,__activeRoute:null,route:{},service:{},thing:{},boot:{}},c=function(e){return function(t,r){return s(o,e,t,r),f[n]}},d=function(e){return p(o,e),_(o,e,"route"),f[n]},v=function(e){if(i(e)){var t=(""+e).substr(10,30).replace(/[^\w]|\s/g,"");return s(o,"boot",t,e),y&&_(o,t,"boot"),f[n]}};s(o,"thing","root",window),s(o,"service","goTo",function(){return d}),s(o,"service","$",function(){return u}),s(o,"thing","$el",u);var y="complete"===document.readyState;return e.onload=function(){y=!0;for(var e in o.boot)o.boot.hasOwnProperty(e)&&_(o,e,"boot")},f[n]={route:c("route"),service:c("service"),thing:c("thing"),goTo:d,boots:v}};return n}()})(window);