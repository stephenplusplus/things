/*!
 * things. it's so thingy.
 * @stephenplusplus
 * github.com/stephenplusplus/things
 */
(function(e){"use strict";var n=function(e,n){return typeof e===n},t=function(e){return!r(e)},r=function(e){return n(e,"undefined")},o=function(e){return n(e,"function")},i=function(e){return n(e,"object")&&t(e.length)},c=function(n){var c=o(n),u=Array.prototype.forEach,d=function(e){return t(e)?e.querySelectorAll.bind(e):void 0};return function(){var a={matches:null,find:function(e){var n,r=d(a.matches[0]);return o(r)&&(n=r(e)),t(n)&&t(n[0])&&(a.matches=n),a},html:function(e){return r(e)?a.matches[0].innerHTML:(o(e)||i(e)||u.call(a.matches,function(n){return n.innerHTML=e}),void 0)}};return c?n(arguments[0]):(a.matches=d(e.document)(arguments[0]),a)}}(e.jQuery),u=["route","service","thing"],d={},a={},f=function(e,n){if(!t(e.route[n].__datael)){var r=c('[data-route="'+n+'"]'),o=r.find("[data-el]");e.route[n].__dataroute=r,e.route[n].__datael=t(o[0])?o:r}},p=function(e,n){return e.route[n].__datael},v=function(e,n,t,i){if("service"===n&&!o(i)&&r(e.service[t].__invoked))throw Error("Services must be functions!");if(e[n][t]=i,o(i)){var c=(""+i).match(/^\s*function\s*\((.*?)\)/);e[n][t].__dependencies=c&&""!==c[1]?c[1].replace(/\s/g,"").split(","):[]}"service"===n&&r(e.service[t].__invoked)&&(e.service[t].__invoked=!1)},s=function(e,n,r){var o={dependencyType:void 0,dependency:void 0};if(!t(n)&&!t(r))return o;if(t(n)&&t(r)?(o.dependencyType=r,o.dependency=e[r][n]):o.dependency=u.filter(function(r){return t(e[r][n])?(o.dependencyType=r,e[r][n]):void 0})[0],!o.dependency||!o.dependencyType)throw Error(n+" doesn't appear to be a thing.");return o},y=function(e,n,t){var r=s(e,n,t).dependency,i=r?e[t][n].__dependencies:[],c="route"===t,u="service"===t,d=u&&e.service[n].__invoked;c&&(e.__incomingRoute=n),"$el"===n&&e.__incomingRoute!==e.__activeRoute&&(r=p(e,e.__incomingRoute));e:if(o(r)){if(d)break e;r=new r(y(e,i[0],s(e,i[0]).dependencyType),y(e,i[1],s(e,i[1]).dependencyType),y(e,i[2],s(e,i[2]).dependencyType),y(e,i[3],s(e,i[3]).dependencyType),y(e,i[4],s(e,i[4]).dependencyType),y(e,i[5],s(e,i[5]).dependencyType),y(e,i[6],s(e,i[6]).dependencyType),y(e,i[7],s(e,i[7]).dependencyType),y(e,i[8],s(e,i[8]).dependencyType),y(e,i[9],s(e,i[9]).dependencyType)),u&&(v(e,"service",n,r),e.service[n].__invoked=!0)}return c&&(e.__activeRoute=n),r};e.things=function(){var n=function(n){var r=a[n];if(t(r))return r;var i=d[n]={__incomingRoute:null,__activeRoute:null,route:{},service:{},thing:{},boot:{}},u=function(e){return function(t,r){return v(i,e,t,r),a[n]}},p=function(e){return f(i,e),y(i,e,"route"),a[n]},s=function(e){if(o(e)){var t=(""+e).substr(10,30).replace(/[^\w]|\s/g,"");return v(i,"boot",t,e),_&&y(i,t,"boot"),a[n]}};v(i,"thing","root",window),v(i,"service","goTo",function(){return p}),v(i,"service","$",function(){return c}),v(i,"thing","$el",c);var _="complete"===document.readyState;return e.onload=function(){_=!0;for(var e in i.boot)i.boot.hasOwnProperty(e)&&y(i,e,"boot")},a[n]={route:u("route"),service:u("service"),thing:u("thing"),goTo:p,boots:s}};return n}()})(window);