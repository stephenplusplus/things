/*!
* things. it's so thingy.
* v0.0.1 @stephenplusplus 3/20/13
* github.com/stephenplusplus/things
*/
(function(e){"use strict";var n={}.toString,t=function(e,n){return typeof e===n},r=function(e){return!i(e)},i=function(e){return t(e,"undefined")},o=function(e){return"[object Function]"===n.call(e)},u=function(e){return"[object String]"===n.call(e)},c=function(e){return"[object Array]"===n.call(e)},a=function(e){return"[object Number]"===n.call(e)},d=function(n){var t=o(n),u=Array.prototype.forEach,a=function(e){return r(e)?e.querySelectorAll.bind(e):void 0};return function(){var d={matches:null,find:function(e){var n,t=a(d.matches[0]);return o(t)&&(n=t(e)),r(n)&&r(n[0])&&(d.matches=n),d},html:function(e){return i(e)?d.matches[0].innerHTML:(o(e)||c(e)||u.call(d.matches,function(n){return n.innerHTML=e}),void 0)}};return t?n(arguments[0]):(d.matches=a(e.document)(arguments[0]),d)}}(e.jQuery),s=["route","service","thing"],f={},v={},p=function(e,n){var t=d('[data-route="'+n+'"]'),i=t.find("[data-el]");T(e,"route",n,"dataroute",t),T(e,"route",n,"datael",r(i[0])?i:t)},y=function(e,n){return p(e,n),_(e,"route",n,"datael")},l=function(e,n){w(e,"incomingRoute",n),w(e,"requestingType","route"),g(e,n,"route"),w(e,"activeRoute",n)},h=function(e,n,t,r){if("service"===n&&!o(r)&&i(_(e,"service",t,"invoked")))throw Error("Services must be functions!");if(e[n][t]=r,e[n]["__"+t]={},o(r)){var u=(""+r).match(/^\s*function\s*\((.*?)\)/);T(e,n,t,"dependencies",u&&""!==u[1]?u[1].replace(/\s/g,"").split(","):[])}"service"===n&&i(_(e,"service",t,"invoked"))&&T(e,n,t,"invoked",!1)},m=function(e,n,t){var o={dependencyType:void 0,dependency:void 0};if(i(n)&&i(t))return o;if(r(n)&&r(t)?(o.dependencyType=t,o.dependency=e[t][n]):o.dependency=s.filter(function(t){return r(e[t][n])?(o.dependencyType=t,e[t][n]):void 0})[0],!o.dependency||!o.dependencyType)throw Error(n+" doesn't appear to be a thing.");return o},g=function(e,n,t){if(i(n)||i(t))return void 0;var r=k(e,"invokingFilter")(n,t),u=_(e,t,n,"dependencies"),a=r.preInstantiation();return c(u)&&w(e,"requestingType",t),o(a)&&!_(e,t,n,"invoked")&&(a=new a(g(e,u[0],m(e,u[0]).dependencyType),g(e,u[1],m(e,u[1]).dependencyType),g(e,u[2],m(e,u[2]).dependencyType),g(e,u[3],m(e,u[3]).dependencyType),g(e,u[4],m(e,u[4]).dependencyType),g(e,u[5],m(e,u[5]).dependencyType),g(e,u[6],m(e,u[6]).dependencyType),g(e,u[7],m(e,u[7]).dependencyType),g(e,u[8],m(e,u[8]).dependencyType),g(e,u[9],m(e,u[9]).dependencyType))),r.postInstantiation(a)},b=function(e){var n={boot:function(){return this.value},route:function(){return this.name!==k(e,"incomingRoute")&&(this.value="Routes cannot be dependencies, sorry!"),this.value},service:function(){return this.value},thing:function(){return"$el"===this.name&&"route"===k(e,"requestingType")&&k(e,"incomingRoute")!==k(e,"activeRoute")&&(this.value=y(e,k(e,"incomingRoute"))),this.value}},t={boot:function(e){return e},route:function(e){return e},service:function(n){return h(e,"service",this.name,n),T(e,"service",this.name,"invoked",!0),n},thing:function(e){return e}};w(e,"invokingFilter",function(r,i){var o={name:r,value:m(e,r,i).dependency};return{preInstantiation:n[i].bind(o),postInstantiation:t[i].bind(o)}})},T=function(e,n,t,r,i){"module"===n?e["__"+r]=i:e[n]["__"+t][r]=i},_=function(e,n,t,r){return"module"===n?e["__"+r]:e[n]["__"+t][r]},w=function(e,n,t){T(e,"module",null,n,t)},k=function(e,n){return _(e,"module",null,n)};e.things=function(){var n=function(n){if(!u(n)&&!a(n))throw Error("Hey! Give your things a name!");var t=v[n];if(r(t))return t;var i=f[n]={route:{},service:{},thing:{},boot:{}};b(i),h(i,"thing","root",window),h(i,"service","goTo",function(){return s}),h(i,"service","$",function(){return d}),h(i,"thing","$el",d);var c=function(e){return function(t,r){return h(i,e,t,r),v[n]}},s=function(e){return l(i,e),v[n]},p=function(e){if(o(e)){var t=(""+e).substr(10,30).replace(/[^\w]|\s/g,"");return h(i,"boot",t,e),y&&g(i,t,"boot"),v[n]}},y="complete"===document.readyState;return e.onload=function(){y=!0;for(var e in i.boot)i.boot.hasOwnProperty(e)&&"_"!==e.charAt(0)&&g(i,e,"boot")},v[n]={route:c("route"),service:c("service"),thing:c("thing"),goTo:s,boots:p}};return n}()})(window);
//@ sourceMappingURL=things.js.map