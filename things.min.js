/*!
 * things. it's so thingy.
 * @stephenplusplus
 * github.com/stephenplusplus/things
 */
(function(e){"use strict";var n=function(e,n){return typeof e===n},t=function(e){return!r(e)},r=function(e){return n(e,"undefined")},o=function(e){return n(e,"function")},i=function(e){return n(e,"string")},u=function(n){var u=o(n),c=Array.prototype.forEach,d=function(e){return t(e)?e.querySelectorAll.bind(e):void 0};return function(){var a={matches:null,find:function(e){var n,r=d(a.matches[0]);return o(r)&&(n=r(e)),t(n)&&t(n[0])&&(a.matches=n),a},html:function(e){return i(e)&&c.call(a.matches,function(n){return i(e)?n.innerHTML=e:void 0}),r(e)?a.matches[0].innerHTML:void 0}};return u?n(arguments[0]):(a.matches=d(e.document.body)(arguments[0]),a)}}(e.jQuery),c=["route","service","thing"],d={},a={},p=function(e,n){if(!t(e.route[n].__datael)){var r=u('[data-route="'+n+'"]'),o=r.find("[data-el]");e.route[n].__dataroute=r,e.route[n].__datael=t(o[0])?o:r}},f=function(e,n){return e.route[n].__datael},y=function(e,n,t,r){var i=e[n][t]=r;if(o(r)){var u=(""+r).match(/^\s*function\s*\((.*?)\)/);i.__dependencies=u&&""!==u[1]?u[1].replace(/\s/g,"").split(","):[]}"service"===n&&(i.__invoked=!1)},v=function(e,n,r){var o={dependencyType:void 0,dependency:void 0};if(!t(n)&&!t(r))return o;if(t(n)&&t(r)?(o.dependencyType=r,o.dependency=e[r][n]):o.dependency=c.filter(function(r){return t(e[r][n])?(o.dependencyType=r,e[r][n]):void 0})[0],!o.dependency||!o.dependencyType)throw Error(n+" doesn't appear to be a thing.");return o},s=function(e,n,t){var r=v(e,n,t).dependency,i=r?r.__dependencies:[],u="route"===t,c="service"===t,d=c&&r.__invoked;u&&(e.__incomingRoute=n),"$el"===n&&e.__incomingRoute!==e.__activeRoute&&(r=f(e,e.__incomingRoute));e:if(o(r)){if(d)break e;r=new r(s(e,i[0],v(e,i[0]).dependencyType),s(e,i[1],v(e,i[1]).dependencyType),s(e,i[2],v(e,i[2]).dependencyType),s(e,i[3],v(e,i[3]).dependencyType),s(e,i[4],v(e,i[4]).dependencyType),s(e,i[5],v(e,i[5]).dependencyType),s(e,i[6],v(e,i[6]).dependencyType),s(e,i[7],v(e,i[7]).dependencyType),s(e,i[8],v(e,i[8]).dependencyType),s(e,i[9],v(e,i[9]).dependencyType)),c&&(y(e,"service",n,r),e.service[n].__invoked=!0)}return u&&(e.__activeRoute=n),r};e.things=function(){var n=function(n){var r=a[n];if(t(r))return r;var i=d[n]={__incomingRoute:null,__activeRoute:null,route:{},service:{},thing:{},boot:{}},c=function(e){return function(n,t){y(i,e,n,t)}},f=function(e){return p(i,e),s(i,e,"route"),i},v=function(e){return o(e)?(y(i,"boot",(""+e).substr(10,30).replace(/[^\w]|\s/g,""),e),i):void 0};return y(i,"thing","root",window),y(i,"service","goTo",function(){return f}),y(i,"thing","$",u),y(i,"thing","$el",u),e.onload=function(){for(var e in i.boot)i.boot.hasOwnProperty(e)&&s(i,e,"boot")},a[n]={route:c("route"),service:c("service"),thing:c("thing"),goTo:f,boots:v}};return n}()})(window);