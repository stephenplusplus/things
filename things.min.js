/*!
* things. it's so thingy.
* v0.0.1 @stephenplusplus 3/19/13
* github.com/stephenplusplus/things
*/
(function(e){"use strict";var n={}.toString,t=function(e,n){return typeof e===n},r=function(e){return!i(e)},i=function(e){return t(e,"undefined")},o=function(e){return"[object Function]"===n.call(e)},u=function(e){return"[object Array]"===n.call(e)},c=function(n){var t=o(n),c=Array.prototype.forEach,d=function(e){return r(e)?e.querySelectorAll.bind(e):void 0};return function(){var a={matches:null,find:function(e){var n,t=d(a.matches[0]);return o(t)&&(n=t(e)),r(n)&&r(n[0])&&(a.matches=n),a},html:function(e){return i(e)?a.matches[0].innerHTML:(o(e)||u(e)||c.call(a.matches,function(n){return n.innerHTML=e}),void 0)}};return t?n(arguments[0]):(a.matches=d(e.document)(arguments[0]),a)}}(e.jQuery),d=["route","service","thing"],a={},s={},f=function(e,n){var t=c('[data-route="'+n+'"]'),i=t.find("[data-el]");g(e,"route",n,"dataroute",t),g(e,"route",n,"datael",r(i[0])?i:t)},p=function(e,n){return f(e,n),T(e,"route",n,"datael")},v=function(e,n){b(e,"incomingRoute",n),b(e,"requestingType","route"),h(e,n,"route"),b(e,"activeRoute",n)},y=function(e,n,t,r){if("service"===n&&!o(r)&&i(T(e,"service",t,"invoked")))throw Error("Services must be functions!");if(e[n][t]=r,e[n]["__"+t]={},o(r)){var u=(""+r).match(/^\s*function\s*\((.*?)\)/);g(e,n,t,"dependencies",u&&""!==u[1]?u[1].replace(/\s/g,"").split(","):[])}"service"===n&&i(T(e,"service",t,"invoked"))&&g(e,n,t,"invoked",!1)},l=function(e,n,t){var o={dependencyType:void 0,dependency:void 0};if(i(n)&&i(t))return o;if(r(n)&&r(t)?(o.dependencyType=t,o.dependency=e[t][n]):o.dependency=d.filter(function(t){return r(e[t][n])?(o.dependencyType=t,e[t][n]):void 0})[0],!o.dependency||!o.dependencyType)throw Error(n+" doesn't appear to be a thing.");return o},h=function(e,n,t){if(i(n)||i(t))return void 0;var r=_(e,"invokingFilter")(n,t),c=T(e,t,n,"dependencies"),d=r.preInstantiation();return u(c)&&b(e,"requestingType",t),o(d)&&!T(e,t,n,"invoked")&&(d=new d(h(e,c[0],l(e,c[0]).dependencyType),h(e,c[1],l(e,c[1]).dependencyType),h(e,c[2],l(e,c[2]).dependencyType),h(e,c[3],l(e,c[3]).dependencyType),h(e,c[4],l(e,c[4]).dependencyType),h(e,c[5],l(e,c[5]).dependencyType),h(e,c[6],l(e,c[6]).dependencyType),h(e,c[7],l(e,c[7]).dependencyType),h(e,c[8],l(e,c[8]).dependencyType),h(e,c[9],l(e,c[9]).dependencyType))),r.postInstantiation(d)},m=function(e){var n={boot:function(){return this.value},route:function(){return this.name!==_(e,"incomingRoute")&&(this.value="Routes cannot be dependencies, sorry!"),this.value},service:function(){return this.value},thing:function(){return"$el"===this.name&&"route"===_(e,"requestingType")&&_(e,"incomingRoute")!==_(e,"activeRoute")&&(this.value=p(e,_(e,"incomingRoute"))),this.value}},t={boot:function(e){return e},route:function(e){return e},service:function(n){return y(e,"service",this.name,n),g(e,"service",this.name,"invoked",!0),n},thing:function(e){return e}};b(e,"invokingFilter",function(r,i){var o={name:r,value:l(e,r,i).dependency};return{preInstantiation:n[i].bind(o),postInstantiation:t[i].bind(o)}})},g=function(e,n,t,r,i){"module"===n?e["__"+r]=i:e[n]["__"+t][r]=i},T=function(e,n,t,r){return"module"===n?e["__"+r]:e[n]["__"+t][r]},b=function(e,n,t){g(e,"module",null,n,t)},_=function(e,n){return T(e,"module",null,n)};e.things=function(){var n=function(n){if(i(n))throw Error("Hey! Name your things!");var t=s[n];if(r(t))return t;var u=a[n]={route:{},service:{},thing:{},boot:{}};m(u),y(u,"thing","root",window),y(u,"service","goTo",function(){return f}),y(u,"service","$",function(){return c}),y(u,"thing","$el",c);var d=function(e){return function(t,r){return y(u,e,t,r),s[n]}},f=function(e){return v(u,e),s[n]},p=function(e){if(o(e)){var t=(""+e).substr(10,30).replace(/[^\w]|\s/g,"");return y(u,"boot",t,e),l&&h(u,t,"boot"),s[n]}},l="complete"===document.readyState;return e.onload=function(){l=!0;for(var e in u.boot)u.boot.hasOwnProperty(e)&&"_"!==e.charAt(0)&&h(u,e,"boot")},s[n]={route:d("route"),service:d("service"),thing:d("thing"),goTo:f,boots:p}};return n}()})(window);